<div class="manager-editor">
  <mat-toolbar>
    <button mat-icon-button (click)="toggleSidenav()" class="toggle-button">
      <mat-icon>{{ sidenavOpened ? 'chevron_left' : 'menu' }}</mat-icon>
    </button>
  </mat-toolbar>
  
  <mat-sidenav-container class="sidenav-container">   
    <mat-sidenav #sidenav mode="side" [opened]="sidenavOpened" class="sidenav">
      <mat-nav-list>
        <mat-list-item (click)="setActiveTab('users')" [class.active]="activeTab === 'users'">
          <mat-icon>person</mat-icon>
          <span *ngIf="sidenavOpened">Użytkownicy</span>
        </mat-list-item>
        <mat-list-item (click)="setActiveTab('reservations')" [class.active]="activeTab === 'reservations'">
          <mat-icon>event</mat-icon>
          <span *ngIf="sidenavOpened">Rezerwacje</span>
        </mat-list-item>
        <mat-list-item (click)="setActiveTab('gantt')" [class.active]="activeTab === 'gantt'">
          <mat-icon>bar_chart</mat-icon>
          <span *ngIf="sidenavOpened">Wykres Gantta</span>
        </mat-list-item>
        <mat-list-item (click)="setActiveTab('tables')" [class.active]="activeTab === 'tables'">
          <mat-icon>table_chart</mat-icon>
          <span *ngIf="sidenavOpened">Stoliki</span>
        </mat-list-item>
        <mat-list-item (click)="setActiveTab('settings')" [class.active]="activeTab === 'settings'">
          <mat-icon>settings</mat-icon>
          <span *ngIf="sidenavOpened">Ustawienia</span>
        </mat-list-item>
      </mat-nav-list>
    </mat-sidenav>
    
    <mat-sidenav-content>
  <!-- Users Tab -->
  <div class="tab-content" *ngIf="activeTab === 'users'">
    <h2 class="section-title">Zarządzanie użytkownikami</h2>
    <ul class="list">
      <li class="card" *ngFor="let user of users">
        <div class="card-header">
          <span>{{ user.first_name }} {{ user.last_name }}</span>
          <button (click)="deleteUser(user.id ?? 0)" class="btn btn-delete">Usuń</button>
        </div>
        <div class="card-body">
          <form (ngSubmit)="updateUser(user)" class="form">
            <mat-form-field appearance="fill">
              <mat-label>Imię</mat-label>
              <input matInput [(ngModel)]="user.first_name" name="first_name" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Nazwisko</mat-label>
              <input matInput [(ngModel)]="user.last_name" name="last_name" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Email</mat-label>
              <input matInput [(ngModel)]="user.email" name="email" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Numer telefonu</mat-label>
              <input matInput [(ngModel)]="user.phone_number" name="phone_number">
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Rola użytkownika</mat-label>
              <mat-select [(ngModel)]="user.is_admin" name="is_admin">
                <mat-option [value]="true">Pracownik</mat-option>
                <mat-option [value]="false">Klient</mat-option>
              </mat-select>
            </mat-form-field>            
            <button type="submit" class="btn btn-update">Aktualizuj</button>
          </form>
        </div>
      </li>
    </ul>
  </div>

  <!-- Reservations Tab -->
  <div class="tab-content" *ngIf="activeTab === 'reservations'">
    <h2 class="section-title">Rezerwacje</h2>
    <ul class="list">
      <li class="card" *ngFor="let reservation of reservations">
        <div class="card-header">
          <span>Rezerwacja #{{ reservation.id }}</span>
          <button (click)="deleteReservation(reservation.id ?? 0)" class="btn btn-delete">Usuń</button>
        </div>
        <div class="card-body">
          <form (ngSubmit)="updateReservation(reservation)" class="form">
            <mat-form-field appearance="fill">
              <mat-label>ID stolika:</mat-label>
              <input matInput [ngModel]="reservation.table_id" name="table_id" required>
            </mat-form-field>
            <label>Początek rezerwacji:
              <input [(ngModel)]="reservation.reservation_start" name="reservation_start" type="datetime-local" required>
            </label>
            <label>Koniec rezerwacji:
              <input [(ngModel)]="reservation.reservation_end" name="reservation_end" type="datetime-local" required>
            </label>
            <mat-slide-toggle 
            [(ngModel)]="reservation.pending" 
            name="pending"
            [labelPosition]="'before'">
            <span>Oczekujące na zatwierdzenie: {{ reservation.pending ? 'Tak' : 'Nie' }}</span>
          </mat-slide-toggle>
                          
            <button type="submit" class="btn btn-update">Aktualizuj</button>
          </form>
        </div>
      </li>
    </ul>
  </div>

  <div class="tab-content gantt-chart" *ngIf="activeTab === 'gantt'">
    <h2 class="section-title ">Wykres Gantta</h2>
    <app-gantt-chart></app-gantt-chart>
  </div>

  <!-- Tables Tab -->
  <div class="tab-content" *ngIf="activeTab === 'tables'">
    <h2 class="section-title">Zarządzanie stolikami</h2>
    <app-table-plan
      class="plan-full-width"
      [tables]="tables"
      [occupiedTables]="[]"
      [selectedTables]="[]"
      [isManager]="true"
      (layoutSaved)="handleLayoutSave($event)"
      (restore)="restoreLayout($event)"
    ></app-table-plan>
  </div>

   <!-- Settings Tab -->
   <div class="tab-content" *ngIf="activeTab === 'settings'">
    <h2 class="section-title">Ustawienia</h2>
    <ul class="list">
      <li class="card" *ngFor="let setting of settings">
        <div class="card-body">
          <form (ngSubmit)="updateSetting(setting)" class="form">
            <mat-form-field appearance="fill">
              <mat-label>Dzień tygodnia</mat-label>
              <input matInput [ngModel]="getDayName(setting.day_of_week)" name="day_of_week" readonly>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Godzina otwarcia</mat-label>
              <input matInput [(ngModel)]="setting.opening_time" name="opening_time" type="time" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Godzina zamknięcia</mat-label>
              <input matInput [(ngModel)]="setting.closing_time" name="closing_time" type="time" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Minimalna długość rezerwacji (minuty)</mat-label>
              <input matInput [(ngModel)]="setting.min_reservation_length" name="min_reservation_length" type="number" required>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Maksymalna długość rezerwacji (minuty)</mat-label>
              <input matInput [(ngModel)]="setting.max_reservation_length" name="max_reservation_length" type="number" required>
            </mat-form-field>
            <button type="submit" class="btn btn-update">Zapisz ustawienia</button>
          </form>
        </div>
      </li>
    </ul>
  </div>
</mat-sidenav-content>
</mat-sidenav-container>
</div>
